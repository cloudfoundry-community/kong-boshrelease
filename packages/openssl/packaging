#!/usr/bin/env bash

# abort script on any command that exits with a non zero value
set -e -x

echo "Extracting openssl ... "
tar xvf openssl/openssl-1.0.2m.tar.gz

mkdir -p ${BOSH_INSTALL_TARGET}/openssl
echo "stuff" > ${BOSH_INSTALL_TARGET}/openssl/stuff.txt
echo "Building openssl ... "
pushd openssl-1.0.2m
  ./config --prefix=/opt/openssl --openssldir=/usr/local/ssl
  make
  make test
  make install
  mv /usr/bin/openssl /root/
  ln -s /usr/local/ssl/bin/openssl /usr/bin/openssl
popd